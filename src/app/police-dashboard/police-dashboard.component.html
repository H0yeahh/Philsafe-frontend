<div class="container">
  <div class="emergency-banner">
    <!-- In case of emergencies, please dial your local emergency services number -->
  </div>
  <div class="flex h-screen">
    <aside class="w-64 bg-white shadow-md">
      <!-- <button type="submit" class="back-button mt-6" style="align-self: flex-start;" (click)="goBack()">BACK</button>  -->
      <div class="p-4 text-center">
        <div class="logo">
          <img [src]="avatarUrl" alt="Profile Picture" >
        </div>
  

        <div *ngIf="adminDetails; else loadingTemplate">
          <h2 class="text-lg font-semibold">{{ adminDetails?.rank_abbr }} {{ adminDetails?.first_name }}
            {{ adminDetails?.last_name }} </h2>
        </div>
  
        <ng-template #loadingTemplate>
          <div id="loading">Loading Police Details...</div>
        </ng-template>
        <p class="text-sm text-zinc-600">Cebu City Police Office</p>
      </div>
      <nav class="mt-7"> <!-- Reduced margin-top to create less space -->
        <ul class="list-none p-0">
          <li>
            <a [routerLink]="['/dashboard']" routerLinkActive="active" class="nav-link">
              <img src="assets/dashbold.svg" alt="Dashboard" class="w-6 h-6 mr-2">
              <span>DASHBOARD</span>
            </a>
          </li>
         
          <li>
            <a  [routerLink]="['/manage-users']" routerLinkActive="active" class="nav-link">
              <i class="fa-solid fa-users" style="margin-right: 10px"></i>
              <span>CITIZENS PORTAL</span>
            </a>
          </li>
          <li>
            <a routerLink="/police-officers" routerLinkActive="active" class="nav-link">
                <img src="assets/police-officer.svg" alt="Manage Police Icon" class="w-6 h-6 mr-2">
                <span>POLICE OFFICERS</span>
            </a>
        </li>   
        <li>
          <a routerLink="/police-archives" routerLinkActive="active" class="nav-link">
              <img src="assets/archive-solid.png" alt="Manage Police Archives Icon" class="archive-icon">
              <span>POLICE ARCHIVES</span>
          </a>
      </li>  
          <li>
            <a href="/police-stations" class="nav-link">
              <img src="assets/manage station.svg" alt="Crime Map Icon" class="w-6 h-6 mr-2">
              <span>MANAGE STATION</span>
            </a>
            <!-- <li>
              <a href="/police-crime-map" class="nav-link">
                <img src="assets/crime-map.svg" alt="Crime Map Icon" class="w-6 h-6 mr-2">
                <span>CRIME MAP</span>
              </a>
            </li> -->
             <li>
            <a
              [routerLink]="['/police-reports']"
              routerLinkActive="active"
              class="nav-link"
            >
              <img
                src="assets/reports.svg"
                alt="Inbox Icon"
                class="w-6 h-6 mr-2"
              />
              <span>VIEW REPORTS</span>
            </a>
          </li>

             <li>
            <a
              [routerLink]="['/police-cases']"
              routerLinkActive="active"
              class="nav-link"
            >
              <img
                src="assets/cases.svg"
                alt="Reports Icon"
                class="w-6 h-6 mr-2"
              />
              <span>VIEW CASES</span>
            </a>
          </li>
         
        </ul>
      </nav>
      <div class="logout">
        <button type="submit" class="logout-button mt-auto" (click)="logout()" >LOG OUT</button>
      </div>

    </aside>


  <!-- <div class ="background">
    <div class="main-content bg-background p-6">
      <div class="flex justify-between items-center mb-6 mt-4">
        <select class="border border-zinc-300 rounded p-2">
          <option>Quarterly</option>
          <option>Monthly</option>
          <option>Yearly</option>
        </select>
        <div class="flex items-center space-x-4">
          <button type="submit" class="refresh-button mt-6" style="align-self: flex-start;">
            <span>REFRESH</span>
          </button>
        </div>
      </div>

      <div class="grid grid-cols-3 gap-4 mb-6">
        <div class="bg-blue-100 p-4 rounded-lg text-center">
          <h2 class="text-lg font-bold">User Requests</h2>
          <p class="text-4xl font-bold">498</p>
        </div>
        <div class="bg-green-100 p-4 rounded-lg text-center">
          <h2 class="text-lg font-bold">Total Number of Users</h2>
          <p class="text-4xl font-bold">1,598</p>
        </div>
        <div class="bg-yellow-100 p-4 rounded-lg text-center">
          <h2 class="text-lg font-bold">Number of Stations</h2>
          <p class="text-4xl font-bold">578</p>
        </div>
      </div>
    </div>

      <div class="bg-white p-4 rounded-lg">
        <img src="assets/chart.jpg" alt="Chart Placeholder">
      </div>
    </div>
  </div> -->

  <main class="content">
    <div class="welcome">
      <h3>Welcome back,</h3>
      <div *ngIf="adminDetails; else loading">
        <h1>
          {{ adminDetails?.rank_abbr }} {{ adminDetails?.first_name }}
          {{ adminDetails?.last_name }}
        </h1>
      </div>
      <ng-template #loading>
        <div id="loading">Loading User...</div>
      </ng-template>
    </div>
    
    <div class="header">
      <div></div>
      <form [formGroup]="policedashboardForm">
        <div class="filter">
          <label for="timePeriodSelect">Select Data to be rendered:</label>
          <select 
            id="timePeriodSelect" 
            [formControl]="timePeriodControl"
            (change)="onSelect()">
            <option value="citizens">Registered Citizens</option>
            <option value="polices">Registered Police</option>
            <option value="stations">All Stations</option>
          </select>
          <!-- Removed the separate button since we're handling change event -->
        </div>
      </form>
    </div>

    <section class="stats">
      <div class="stat-box solved-cases" (click)="openModal('citizens')">
        <h3>Registered Citizens</h3>
        <p>{{ citizensCount }}</p>
      </div>
      <div class="stat-box reported-cases" (click)="openModal('polices')">
        <h3>Registered Police</h3>
        <p>{{ policesCount }}</p>
      </div>
      <div class="stat-box under-investigation" (click)="openModal('stations')">
        <h3>All Stations</h3>
        <p>{{ stationsCount }}</p>
      </div>
    </section>

    <section class="graph-section">
      <canvas id="casesGraph"></canvas>
    </section>

    
    
  </main>

  <div class="parent-modal" *ngIf="isModalOpen">
    <div class="modal">
      <button class="modal-close" (click)="closeModal()">X</button>
      <div class="modal-content">
        <h3 *ngIf="modalType === 'citizens'">All Citizens</h3>
        <h3 *ngIf="modalType === 'polices'">All Polices</h3>
        <h3 *ngIf="modalType === 'stations'">All Stations</h3>
  
        <div class="modal-table">
          <table>
            <thead>
              <tr *ngIf="modalType === 'citizens'">
                <th>Citizen ID</th>
                <th>Full Name</th>
                <th>Email</th>
                <th>Contact Number</th>
                <th>Verification Status</th>
              </tr>
              <tr *ngIf="modalType === 'polices'">
                <th>Station ID</th>
                <th>Police ID</th>
                <th>Full Name</th>
                <th>Badge Number</th>
                <th>Specialized Role</th>
                <th>Unit</th>

              </tr>
              <tr *ngIf="modalType === 'stations'">
                <th>Station ID</th>
                <th>Station Name</th>
                <th>Barangay</th>
                <th>Province</th>
                <th>Municipality</th>
              </tr>
            </thead>
  
            <tbody *ngIf="modalType === 'citizens'">
              <ng-container *ngIf="citizens && citizens.length > 0; else noData">
                <tr *ngFor="let citizen of citizens">
                  <td>{{ citizen.citizen_id }}</td>
                  <td>{{ citizen.firstname }}, {{ citizen.lastname }} </td>
                  <td>{{ citizen.email }}</td>

                  <td>{{ citizen.contact_num }}</td>
                  <td>{{ citizen.role }}</td>

                </tr>
              </ng-container>
            </tbody>
  
            <tbody *ngIf="modalType === 'polices'">
              <ng-container *ngIf="polices && polices.length > 0; else noData">
                <tr *ngFor="let police of polices">
                  <td>{{ police.station_id }}</td>
                  <td>{{ police.police_id }}</td>
                  <td>{{police.rank_abbr}} {{ police.firstname }}, {{ police.lastname }}</td>
                  <td>{{ police.badge_number }}</td>
                  <td>{{ police.role }}</td>
                  <td>{{ police.unit }}</td>

                </tr>
              </ng-container>
            </tbody>
  
            <tbody *ngIf="modalType === 'stations'">
              <ng-container *ngIf="stations && stations.length > 0; else noData">
                <tr *ngFor="let station of stations">
                  <td>{{ station.station_id }}</td>
                  <td>{{ station.hq }}</td>
                  <td>{{ station.barangay }}</td>
                  <td>{{ station.province }}</td>
                  <td>{{ station.municipality }}</td>

                </tr>
              </ng-container>
            </tbody>
  
            <ng-template #noData>
              <tr>
                <td colspan="3" style="text-align: center; font-weight: bold;">
                  No data available for {{ modalType }}.
                </td>
              </tr>
            </ng-template>
  
          </table>
        </div>
      </div>
    </div>
  </div>
  