

<div class="container">
    <div class="emergency-banner">
      <!-- In case of emergencies, please dial your local emergency services number -->
    </div>
    <div class="min-h-screen bg-zinc-100 flex">
      <aside class="w-64 bg-white shadow-md">
        <div class="p-4 text-center">
          <div class="logo">
            <img [src]="avatarUrl" alt="CCPO Logo" />
          </div>
  
          <div *ngIf="stationDetails; else loadingTemplate">
            <h2 class="text-lg font-semibold">{{ stationDetails?.hq }}</h2>
          </div>
  
          <ng-template #loadingTemplate>
            <div id="loading">Loading Station Details...</div>
          </ng-template>
          <p class="text-sm text-zinc-600">Cebu City Police Office</p>
        </div>
        <nav class="mt-7">
          <ul class="list-none p-0">
            <li>
              <a [routerLink]="['/station-dashboard']" routerLinkActive="active" class="nav-link">
                <img
                  src="assets/dashbold.svg"
                  alt="Dashboard Icon"
                  class="w-6 h-6 mr-2"
                />
                <span>DASHBOARD</span>
              </a>
            </li>
            <li>
              <a [routerLink]="['/station-cases']" routerLinkActive="active" class="nav-link">
                <img
                  src="assets/cases.svg"
                  alt="Inbox Icon"
                  class="w-6 h-6 mr-2"
                />
                <span>CASES</span>
              </a>
            </li>
            <li>
              <a [routerLink]="['/station-case-queue']" routerLinkActive="active" class="nav-link">
                <img
                  src="assets/reports.svg"
                  alt="Reports Icon"
                  class="w-6 h-6 mr-2"
                />
                <span>REPORTS</span>
              </a>
            </li>
            <li>
              <a [routerLink]="['/map']" routerLinkActive="active" class="nav-link">
                <img
                  src="assets/crime-map.svg"
                  alt="Crime Map Icon"
                  class="w-6 h-6 mr-2"
                />
                <span>CRIME MAP</span>
              </a>
            </li>
            <!-- <li>
              <a [routerLink]="['/station-list-of-officers']" routerLinkActive="active" class="nav-link">
                <img
                  src="assets/station.svg"
                  alt="Station Icon"
                  class="w-6 h-6 mr-2"
                />
                <span>STATION</span>
              </a>
            </li>
             -->
            <li>
                <a [routerLink]="['/station-citizens']" routerLinkActive="active" class="nav-link">
                  <i class="fa-solid fa-users" style="margin-right: 10px"></i>
                  <span>CITIZENS</span>
                </a>
              </li>
            <!-- <li>
              <a href="#" class="nav-link">
                <img
                  src="assets/support.svg"
                  alt="Contact Support Icon"
                  class="w-6 h-6 mr-2"
                />
                <span>CONTACT SUPPORT</span>
              </a>
            </li> -->
          </ul>
          <!-- <div class="logout">
            <button type="submit" class="button" (click)="logout()">
              LOG OUT
            </button>
          </div> -->
        </nav>
      </aside>
  
      <!-- <main class="content">
        <div class="header">
          <h1>DASHBOARD</h1>
          <form [formGroup]="dashboardForm">
            <div class="filter">
              <select formControlName="timePeriod">
                <option value="quarterly">Quarterly</option>
              </select>
              <button type="button" class="refresh-button" (click)="onRefresh()">
                Refresh
              </button>
            </div>
          </form>
        </div>
  
        <section class="stats">
          <div class="stat-box solved-cases">
            <h3>Solved Cases</h3>
            <p>{{ dashboardForm.status }}</p>
          </div>
          <div class="stat-box reported-cases">
            <h3>Number of Reported Cases</h3>
            <p>{{ dashboardForm.value.reportedCases }}</p>
          </div>
          <div class="stat-box under-investigation">
            <h3>Under Investigation</h3>
            <p>{{ dashboardForm.value.underInvestigation }}</p>
          </div>
        </section>
  
        <section class="graph-section">
          <canvas id="casesGraph"></canvas>
        </section>
      </main>
    </div>
  </div> -->
  
      <main class="content">

        <div class="profile-menu-container">
          <div class="profile-icon" (click)="toggleProfileMenu()">
            <img *ngIf="policePersonData?.profile_picture; else defaultAvatar" 
                 [src]="policePersonData?.profile_picture" 
                 alt="Profile" 
                 class="profile-image" />
            <ng-template #defaultAvatar>
              <div class="default-avatar">
                <i class="fa-solid fa-user"></i>
              </div>
            </ng-template>
          </div>
          <!-- Dropdown menu for profile -->
          <div class="profile-dropdown" *ngIf="isProfileMenuOpen">
            <div class="dropdown-item" [routerLink]="['/station-editpolice']">
              <i class="fa-solid fa-user-pen"></i> Edit Profile
            </div>
            <div class="dropdown-item" (click)="logout()">
              <i class="fa-solid fa-sign-out-alt"></i> Logout
            </div>
          </div>
        </div>

        <div class="welcome flex justify-between items-center mb-4">
            <div class="header-title">
                <h1>CITIZEN'S PORTAL</h1>
              </div>
          
          <div class="text-left date-time">
            <p><strong>Date:</strong> {{ currentDate }}</p>
            <p><strong>Time:</strong> {{ currentTime }}</p>
          </div>
        </div>
        
        <div class="header">
          <div></div>
          
        </div>
  
        <section class="new-reports">
         
              <table class="reports-table">
                <thead>
                  <tr>
                    <th></th>
                    <th>Citizen</th>
                    <th>Citizen ID</th>
                    <th>Remarks</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- If there is a search query -->
                  <ng-container *ngIf="searchQuery || selectedRemark !== 'all'; else defaultReports">
                    <!-- Show filtered reports if results are found -->
                    <ng-container *ngIf="filteredReports.length > 0; else noResults">
                      <tr
                        *ngFor="
                          let report of filteredReports
                            | paginate
                              : {
                                  id: 'cases',
                                  itemsPerPage: pageSize,
                                  currentPage: currentPage,
                                  totalItems: totalReports
                                }
                        "
                        [id]="'report-' + report.report_id"
              
                      >
                        <td>
                          <span
                            [class.highlight]="
                              isFieldMatched(getCitizenName(report.citizen_id), searchQuery)
                            "
                            [innerHTML]="highlight(getCitizenName(report.citizen_id))"
                          ></span>
                        </td>
                        <td>
                          <span
                            [class.highlight]="
                              isFieldMatched(report.report_id, searchQuery)
                            "
                            [innerHTML]="highlight(report.report_id)"
                          ></span>
                        </td>
                        <td>
                          <span
                            [class.highlight]="
                              isFieldMatched(report.subcategory_name, searchQuery)
                            "
                            [innerHTML]="highlight(report.subcategory_name)"
                          ></span>
                        </td>
                        <td>
                          <span
                            [class.highlight]="
                              isFieldMatched(report.reported_date, searchQuery)
                            "
                            [innerHTML]="highlight(report.reported_date | date)"
                          ></span>
                        </td>
                        <div *ngIf="!report.is_spam; else spamReports">
                          <td style="text-decoration: none; color: #00c900">For Endorse</td>
                        </div>
                        <ng-template #spamReports>
                          <td style="color: red;">Marked as Spam</td>
                        </ng-template>
                        <td
                          class="icon"
                  
                        >
                          <img src="assets/delete.svg" />
                        </td>
                      </tr>
                    </ng-container>
                
                    <!-- No results found -->
                    <ng-template #noResults>
                      <tr>
                        <td colspan="6" class="no-results">
                          No results found for "{{ searchQuery }}"
                        </td>
                      </tr>
                    </ng-template>
                  </ng-container>
                
                  <!-- Default reports -->
                  <ng-template #defaultReports>
                    <tr
                      *ngFor="
                        let citizen of citizens
                          | paginate
                            : {
                                id: 'cases',
                                itemsPerPage: pageSize,
                                currentPage: currentPage,
                                totalItems: totalReports
                              }
                      "
                               (click)="openCitizenReports(citizen.citizen_id); $event.stopPropagation()"         >


                    <td></td>
                    <td *ngIf="citizens">
                        <div class="d-flex align-items-center gap-2">
                          <img 
                            [src]="userAvatars.get(citizen.citizen_id) "
                            alt="Profile Picture" 
                            class="avatar-img"
                          />
                          <span class="citizen-name">{{ getCitizenName(citizen.citizen_id) }}</span>
                        </div>
                      </td>
                      
                      
                     
                      <td>{{ citizen.citizen_id }}</td>
            
                      <td>
                        <ng-container *ngIf="spammerCitizenIds.has(citizen.citizen_id); else notSpammer">
                            <span style="color: red">Potential Spammer</span>
                          </ng-container>
                          <ng-template #notSpammer>
                            <span style="color: #00c900" class="text-success">Spam-Free</span>
                          </ng-template>

                      </td>
                    
                      <td
                        class="icon"
                        (click)="onRestrict(isSpammer.bind(this), citizen.citizen_id); $event.stopPropagation()"
                       
                      >
                        <img src="assets/delete.svg" />
                      </td>
                    </tr>
                  </ng-template>
                </tbody>
                
              </table>

              <div class="parent-modal" *ngIf="isModalOpen">
                <div class="modal">
                  <button class="modal-close" (click)="isModalOpen = false">Close</button>
                  <div class="modal-content">

                    <div class="modal-header">
                      <h3>Citizen Reports</h3>
                      
                    </div>
                
                    <div class="modal-table">
                      <table>
                        <thead>
                          <tr>
                            <th>Report ID</th>
                            <th>Incident Name</th>
                            <th>Date</th>
                            <th>Category Name</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let report of selectedCitizenReports">
                            <td>{{ report.report_id }}</td>
                            <td>{{ report.subcategory_name }}</td>
                            <td>{{ report.reported_date.slice(0, 10) + ' ' + report.reported_date.slice(11, 16) }}</td>
                            <td>{{ report.category_name }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
              


              <pagination-controls id="cases" (pageChange)="currentPage = $event">
              </pagination-controls>
   
          </section>
        
      </main>
    </div>
  </div>
  