<div class="container">
  <div class="emergency-banner">
    <!-- In case of emergencies, please dial your local emergency services number -->
  </div>
  <div class="min-h-screen bg-zinc-100 flex">
    <aside class="w-64 bg-white shadow-md">
      <div class="p-4 text-center">
        <div class="logo">
          <img src="assets/station10.png" alt="CCPO Logo" />
        </div>

        <div *ngIf="stationDetails; else loadingTemplate">
          <h2 class="text-lg font-semibold">{{ stationDetails?.hq }}</h2>
        </div>

        <ng-template #loadingTemplate>
          <div id="loading">Loading Station Details...</div>
        </ng-template>
        <p class="text-sm text-zinc-600">Cebu City Police Office</p>
      </div>
      <nav class="mt-7">
        <ul class="list-none p-0">
          <li>
            <a
              [routerLink]="['/station-dashboard']"
              routerLinkActive="active"
              class="nav-link"
            >
              <img
                src="assets/dashbold.svg"
                alt="Dashboard Icon"
                class="w-6 h-6 mr-2"
              />
              <span>DASHBOARD</span>
            </a>
          </li>
          <li>
            <a
              [routerLink]="['/station-cases']"
              routerLinkActive="active"
              class="nav-link"
            >
              <img
                src="assets/cases.svg"
                alt="Inbox Icon"
                class="w-6 h-6 mr-2"
              />
              <span>CASES</span>
            </a>
          </li>
          <li>
            <a
              [routerLink]="['/station-case-queue']"
              [ngClass]="{ active: isReportsActive() }"
              class="nav-link"
            >
              <img
                src="assets/reports.svg"
                alt="Reports Icon"
                class="w-6 h-6 mr-2"
              />
              <span>REPORTS</span>
            </a>
          </li>
          <li>
            <a
              [routerLink]="['/station-crime-map']"
              routerLinkActive="active"
              class="nav-link"
            >
              <img
                src="assets/crime-map.svg"
                alt="Crime Map Icon"
                class="w-6 h-6 mr-2"
              />
              <span>CRIME MAP</span>
            </a>
          </li>
          <li>
            <a
              [routerLink]="['/station-list-of-officers']"
              routerLinkActive="active"
              class="nav-link"
            >
              <img
                src="assets/station.svg"
                alt="Station Icon"
                class="w-6 h-6 mr-2"
              />
              <span>STATION</span>
            </a>
          </li>
          <!-- <li>
            <a href="#" class="nav-link">
              <img
                src="assets/support.svg"
                alt="Contact Support Icon"
                class="w-6 h-6 mr-2"
              />
              <span>CONTACT SUPPORT</span>
            </a>
          </li> -->
        </ul>
        <div class="logout">
          <button type="submit" class="button" (click)="logout()">
            LOG OUT
          </button>
        </div>
      </nav>
    </aside>

    <main class="content">
      <!-- <form [formGroup]="endorseForm"> -->
        <div>
          <button (click)="exportToPDF(selectedReport.report_id)" class="export-btn">
            <i class="fas fa-file-export"></i>
            Export to PDF
          </button>
        </div>
        
       
        <div *ngIf="forExport" id="report-content">
          <div >

            <div class="univ-person-data">
              <div class="parent-person-data">
                <div class="prof-pic">
                  <img [src]="avatarUrl" alt="Profile Picture">
                </div>
                
              </div>
              <div *ngIf="citizenData" class="person-data">
                <section class="report-details">
                  <thead>
                    <tr>
                      <th colspan="2" class="category-label">COMPLAINANT</th>
                    </tr>
                  </thead>
                  <div class="complainant-data">
                    <div>
                      
                      <h3><span>{{ citizenData.firstname }}, {{ citizenData.lastname }}</span></h3>
                    </div>      
                    <div class="complainant-id">
                      <span> <b>Complainant Id:</b> <br> <p style="text-align: end;">{{ citizenData.citizen_id }}</p></span>
                    </div>    
                  </div>   
                </section>
                
                <span>{{ accountData.contact_num }}</span>
                <span>{{ accountData.email }}</span>
                <span>
                  {{ locationData.block || "" }}
                  {{ locationData.street || "" }}
                  {{ locationData.barangay || "" }}
                  {{ locationData.municipality || "" }}
                  {{ locationData.province || "" }}
                  {{ locationData.Region || "" }}
                </span>
              </div>   
            </div>
            
            <div class="container">
              <main class="main-content">
                <h2 style="padding-bottom: 30px">
                  <span>{{ selectedReport.subcategory_name }}</span>
                </h2>
                <section class="report-details">
              
                  <div class="table-container">
                    <table>
                <thead>
                  <tr>
                    <th colspan="2" class="category-label">REPORT DATA</th>
                  </tr>
                </thead>
                <tr>
                  <td style="padding-bottom: 2rem"><h3>Report ID</h3></td>
                  <td style="text-align: end; padding-bottom: 2rem">
                    <span>{{ selectedReport.report_id }}</span>
                  </td>
                </tr>
                <tr>
                <tr>
                  <td style="padding-bottom: 2rem"><h3>Reported Date</h3></td>
                  <td style="text-align: end; padding-bottom: 2rem">
                    <span>{{ selectedReport.reported_date | date }}</span>
                  </td>
                </tr>
                <tr>
                  <td style="padding-bottom: 2rem"><h3>Incident Name</h3></td>
                  <td style="text-align: end; padding-bottom: 2rem">
                    <span>{{ selectedReport.subcategory_name }}</span>
                  </td>
                </tr>
                <tr>
                  <td style="padding-bottom: 2rem"><h3>Category Name</h3></td>
                  <td style="text-align: end; padding-bottom: 2rem">
                    <span>{{ selectedReport.category_name }}</span>
                  </td>
                </tr>
                <tr>
                  <td style="padding-bottom: 2rem"><h3>Incident Date</h3></td>
                  <td style="text-align: end; padding-bottom: 2rem">
                    <span>{{ selectedReport.incident_date | date }}</span>
                  </td>
                </tr>
                <tr>
                  <td style="padding-bottom: 2rem; vertical-align: top;"><h3>Narrative</h3></td>
                  <td style="text-align: end; padding-bottom: 2rem">
                    <div class="narrative">
                      <textarea
                      style="width: 99%; height:150px; text-align: justify; justify-content: flex-start; resize: none;"
                        [(ngModel)]="selectedReport.report_body"
                        placeholder="Description"
                        readonly
                      ></textarea>
                    </div>
                    
                  </td>
                </tr>
           
                    
               
                     
                      <tr>
                        <td style="padding-bottom: 2rem"><h3>Submited ID</h3></td>
                        <td style="text-align: end; padding-bottom: 2rem">
                          <!-- <a
                            style="color: blue; text-decoration: underline"
                            (click)="viewID(citizenData.citizen_proof)"
                            >View Complainant ID</a
                          > -->
                        
                            <div class="modal-content">
        
                              <img  [src]="
                              citizenData.citizen_proof
                            "
                            alt="Evidence Image" />
                            </div>
                         
                        </td>
                      </tr>
                    </table>
                     
    
                    <thead>
                      <tr>
                        <th colspan="2" class="category-label">SUSPECT DATA</th>
                      </tr>
                    </thead>
                             <div class="data-container">
                              <!-- Centered Div -->
                              
                                <tr>
                                  <td><b>Suspect Id</b></td>
                                  <td><b>Suspect Name</b></td>
                                  <td><b>Civil Status</b></td>
                                  <td><b>Gender</b></td>
                                  <td><b>Arrested</b></td>
                                  <td><b>Deceased</b></td>
                                  <td><b>Nationality</b></td>
                  
                                </tr>
                            
                                <tr *ngFor="let suspect of suspects" style="padding-right: 2rem" (click)="viewSuspectDesc(suspect.suspect_id)">
                                  <td style="text-align: end; padding-bottom: 2rem; padding-right: 6rem;">
                                    <span>{{ suspect?.suspect_id }}</span>
                                  </td>
                                  <td style="text-align: end; padding-bottom: 2rem; padding-right: 6rem;">
                                    <span>{{ suspect.first_name }} {{ suspect.last_name }}</span>
                                  </td>
                                  <td style="text-align: end; padding-bottom: 2rem; padding-right: 6rem;">
                                    <span>{{ getCivilStatus(suspect.person_id) || 'Unknown' }}</span>
                                  </td>
                                  <td style="text-align: end; padding-bottom: 2rem; padding-right: 6rem;">
                                    <span>{{ getGenderName(suspect.sex) }}</span>
                                  </td>
                                  <td style="text-align: end; padding-bottom: 2rem; padding-right: 6rem;">
                                    <span>{{ isCaught }}</span>
                                  </td>
                                  <td style="text-align: end; padding-bottom: 2rem; padding-right: 6rem;">
                                    <span>{{ isCitizenDeceased(suspect.bio_status) }}</span>
                                  </td>
                                  <td style="text-align: end; padding-bottom: 2rem; padding-right: 6rem;">
                                    <span>{{ suspectDesc?.ethnicity || 'Unknown' }}</span>
                                  </td>
                                </tr>
                          
                            </div>
    
    
                      <thead>
                        <tr>
                          <th colspan="2" class="category-label">VICTIM DATA</th>
                        </tr>
                      </thead>
                        <div class="data-container">
                          <!-- Centered Div -->
                         
                            <tr>
                              <td><b>Victim Id</b></td>
                              <td><b>Victim Name</b></td>
                              <td><b>Civil Status</b></td>
                              <td><b>Gender</b></td>
                              <td><b>Deceased</b></td>
                              <td><b>Nationality</b></td>
              
                            </tr>
                        
                            <tr *ngFor="let victim of victims" style="padding-right: 2rem">
                              <td style="text-align: end; padding-bottom: 2rem; padding-right: 6rem;">
                                <span>{{ victim?.victim_id }}</span>
                              </td>
                              <td style="text-align: end; padding-bottom: 2rem; padding-right: 6rem;">
                                <span>{{ victim.firstname }} {{ victim.lastname }}</span>
                              </td>
                              <td style="text-align: end; padding-bottom: 2rem; padding-right: 6rem;">
                                <span>{{ getCivilStatus(victim.person_id) || 'Unknown' }}</span>
                              </td>
                              <td style="text-align: end; padding-bottom: 2rem; padding-right: 6rem;">
                                <span>{{ getGenderName(victim.sex) }}</span>
                              </td>
    
                              <td style="text-align: end; padding-bottom: 2rem; padding-right: 6rem;">
                                <span>{{ isCitizenDeceased(victim.bio_status) }}</span>
                              </td>
                              <td style="text-align: end; padding-bottom: 2rem; padding-right: 6rem;">
                                <span>{{ victimDesc?.ethnicity || 'Unknown' }}</span>
                              </td>
                            </tr>
        
                        </div>
    
                       
                      
                   
                         
                        <thead>
                          <tr>
                            <th colspan="2" class="category-label">EVIDENCES</th>
                          </tr>
                        </thead>
        
                          <!-- <div *ngIf="isLoading">Loading evidences...</div> -->
                          
                          <div
                            *ngIf="!isLoading && evidences.length > 0"
                            class="evidence-container"
                          >
                            <div
                              *ngFor="let evidence of evidences"
                              class="evidence-item"
                              (click)="openModal(evidence)"
                            >
        
                              <div *ngIf="evidence.content_type.startsWith('image/')">
                                <img
                                  [src]="
                                    'data:' +
                                    evidence.content_type +
                                    ';base64,' +
                                    cleanBase64(evidence.file_contents)
                                  "
                                  alt="Evidence Image"
                                />
                              </div>
        
                              <div *ngIf="evidence.content_type === 'application/pdf'">
                                <embed
                                  [src]="
                                    'data:' +
                                    evidence.content_type +
                                    ';base64,' +
                                    evidence.file_contents
                                  "
                                  width="100%"
                                  height="600px"
                                  type="application/pdf"
                                />
                              </div>
                              <div *ngIf="evidence.content_type === 'text/plain'">
                                <pre>{{ decodeBase64(evidence.file_contents) }}</pre>
                              </div>
                              <div
                                *ngIf="
                                  evidence.content_type === 'application/msword' ||
                                  evidence.content_type ===
                                    'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
                                "
                              >
                                <span
                                  >Document (.docx) cannot be viewed directly in
                                  browser.</span
                                >
                                <!-- You could integrate a viewer for DOCX files, like using Google Docs Viewer or a custom viewer -->
                              </div>
                              <div
                                *ngIf="
                                  evidence.content_type ===
                                    'application/vnd.ms-excel' ||
                                  evidence.content_type ===
                                    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
                                "
                              >
                                <span
                                  >Spreadsheet (.xlsx) cannot be viewed directly in
                                  browser.</span
                                >
                              </div>
        
                              <!-- Handling Audio files -->
                              <div *ngIf="evidence.content_type.startsWith('audio/')">
                                <audio controls>
                                  <source
                                    [src]="
                                      'data:' +
                                      evidence.content_type +
                                      ';base64,' +
                                      evidence.file_contents
                                    "
                                    type="{{ evidence.content_type }}"
                                  />
                                  Your browser does not support the audio element.
                                </audio>
                              </div>
        
                              <!-- Handling Video files -->
                              <div *ngIf="evidence.content_type.startsWith('video/')">
                                <video width="100%" controls>
                                  <source
                                    [src]="
                                      'data:' +
                                      evidence.content_type +
                                      ';base64,' +
                                      evidence.file_contents
                                    "
                                    type="{{ evidence.content_type }}"
                                  />
                                  Your browser does not support the video element.
                                </video>
                              </div>
        
                              <!-- If file type doesn't match any specific one above -->
                              <div
                                *ngIf="
                                  !evidence.content_type.startsWith('image/') &&
                                  !evidence.content_type.startsWith('audio/') &&
                                  !evidence.content_type.startsWith('video/')
                                "
                              >
                                <strong>File:</strong>
                                <span>{{ evidence.content_type }}</span>
                                <a
                                  [href]="
                                    'data:' +
                                    evidence.content_type +
                                    ';base64,' +
                                    evidence.file_contents
                                  "
                                  download
                                >
                                  Download File
                                </a>
                              </div>
                            </div>
                          </div>
                          <div *ngIf="!isLoading && evidences.length === 0">
                            No evidences found.
                          </div>
        
                          <div
                            *ngIf="isModalOpen"
                            class="modal-overlay"
                            (click)="closeModal()"
                          >
                            <div
                              class="modal-content"
                              (click)="$event.stopPropagation()"
                            >
                              <button class="modal-close" (click)="closeModal()">
                                X
                              </button>
                              <div *ngIf="selectedEvidence">
                                <div
                                  *ngIf="
                                    selectedEvidence.content_type.startsWith('image/')
                                  "
                                >
                                  <img
                                    [src]="
                                      'data:' +
                                      selectedEvidence.content_type +
                                      ';base64,' +
                                      cleanBase64(selectedEvidence.file_contents)
                                    "
                                    alt="Evidence Image"
                                  />
                                </div>
                                <div
                                  *ngIf="
                                    selectedEvidence.content_type === 'application/pdf'
                                  "
                                >
                                  <embed
                                    [src]="
                                      'data:' +
                                      selectedEvidence.content_type +
                                      ';base64,' +
                                      selectedEvidence.file_contents
                                    "
                                    width="100%"
                                    height="600px"
                                    type="application/pdf"
                                  />
                                </div>
                                <div
                                  *ngIf="
                                    selectedEvidence.content_type.startsWith('audio/')
                                  "
                                >
                                  <audio controls>
                                    <source
                                      [src]="
                                        'data:' +
                                        selectedEvidence.content_type +
                                        ';base64,' +
                                        selectedEvidence.file_contents
                                      "
                                      type="{{ selectedEvidence.content_type }}"
                                    />
                                  </audio>
                                </div>
                                <div
                                  *ngIf="
                                    selectedEvidence.content_type.startsWith('video/')
                                  "
                                >
                                  <video width="100%" controls>
                                    <source
                                      [src]="
                                        'data:' +
                                        selectedEvidence.content_type +
                                        ';base64,' +
                                        selectedEvidence.file_contents
                                      "
                                      type="{{ selectedEvidence.content_type }}"
                                    />
                                  </video>
                                </div>
                              </div>
                     
                          </div>
                        </div>
                        <div *ngIf="errorMessage">{{ errorMessage }}</div>
                      
    
                      <div *ngIf="isSignatureVisible" class="modal">
                        <div class="modal-content">
                          <span class="close" (click)="closeSignature()"
                            >&times;</span
                          >
                          <img [src]="currentSignature" alt="E-Signature" />
                        </div>
                      </div>
    
                      <div *ngIf="isIDvisible" class="modal">
                        <div class="modal-content">
                          <span class="close" (click)="closeID()"
                            >&times;</span
                          >
                          <img [src]="currentID" alt="ID" />
                        </div>
                        </div>
    
                        <table>
                        <tr>
                          <td style="padding-bottom: 0.5rem; padding-top:10rem;"><h3>Signed By</h3></td>
                          <tr>
                            <td style="text-align: left; padding-bottom: 0.5rem">
                              <div *ngIf="selectedReport.e_signature.startsWith('data:image/')">
                                <img
                                  [src]="selectedReport.e_signature"
                                  alt="E-Signature"
                                  style="max-width: 200px; max-height: 100px;"
                                />
                                
                              </div>
                              <div *ngIf="!selectedReport.e_signature.startsWith('data:image/')">
                                <span>No signature available</span>
                              </div>
                            </td>
                            
                          </tr>
                          <div *ngIf="citizenData" class="sign-name">
                            <span>{{ citizenData.firstname }}, {{ citizenData.lastname }}</span>
                            <span style=" font-weight:bold">Complainant</span>
                          </div>
                          

                    </table>
                  </div>

                </section>
              </main>
            </div>
          </div>
          </div>
          



        <div class="univ-person-data">
          <div class="parent-person-data">
            <!-- <h3>Complainant Name:</h3>
            <h3>Contact Number:</h3>
            <h3>Email Address:</h3>
            <h3>Address:</h3> -->
            <div class="prof-pic">
              <img [src]="avatarUrl" alt="Profile Picture">
            </div>
            
          </div>
          <div *ngIf="citizenData" class="person-data">
            <section class="report-details">
              <div class="complainant-data">
                <div>
                  <h3><span>{{ citizenData.firstname }}, {{ citizenData.lastname }}</span></h3>
                </div>      
                <div class="complainant-id">
                  <span> <b>Complainant Id:</b> <br> <p style="text-align: end;">{{ citizenData.citizen_id }}</p></span>
                </div>    
              </div>   
            </section>
            
            <span>{{ accountData.contact_num }}</span>
            <span>{{ accountData.email }}</span>
            <span>
              {{ locationData.block || "" }}
              {{ locationData.street || "" }}
              {{ locationData.barangay || "" }}
              {{ locationData.municipality || "" }}
              {{ locationData.province || "" }}
              {{ locationData.Region || "" }}
            </span>
          </div>   
        </div>
        
        <div class="container">
          <main class="main-content">
            <h2 style="padding-bottom: 30px">
              <span>{{ selectedReport.subcategory_name }}</span>
            </h2>
            <section class="report-details">
              <div class="report-header">
                <div class="report-left">
                  <div class="form-group">
                    <label for="duty-officer">Assigned Team</label>
                    <select 
                    id="duty-officer" 
                    [(ngModel)]="assignedTeam"
                    (change)="onAssignChange($event)"
                    >
                      <option
                        *ngFor="let police of polices"
                        [value]="police.unit"
                      >
                        {{ police.unit   }}
                      </option>
                    </select>
                  </div>
                  <div class="form-group">
                  </div>
                </div>
                <tr>
                  <td>
                    <button
                      type="button"
                      class="endorse-btn"
                      (click)="showModal = true"
                    >
                      Add Case
                    </button>
                  </td>
                  <div class="modal" *ngIf="showModal">
                    
                    <div class="modal-content">
                      <button class="modal-close" (click)="showModal = false">x</button>
                      <div class="modal-menu">
                        <h3>Would you like to:</h3>
                        <button type="button" (click)="navigateToCase(selectedReport.report_id)">
                          Add New Case
                        </button>
                        <button type="button" (click)="openSubModal()">
                          Add Existing Case
                        </button>
                      </div>
                      
                    </div>
                  </div>
                  
                  <!-- Sub-modal for Add Existing Case -->
                  <div class="modal" *ngIf="showSubModal">
                    
                    <div class="modal-content-case">

                      <div class="view-cases-close">
                        <button type="button" class="view-all-btn" (click)="showCasesModal = true">
                          View Cases
                        </button>
  
                      </div>

                      <div class="enter-case">
                        <h3>Enter existing case ID:</h3>
                        <input type="text" class="input-case" [(ngModel)]="existingCaseId" placeholder="Case ID" />
                        <button type="button" class="submit-btn" (click)="addExistingCase(selectedReport.report_id, existingCaseId)">
                          Submit
                        </button>
                      </div>
   
                      <button type="button" class="modal-close" (click)="showSubModal = false">
                        X
                      </button>
                    </div>
                  </div>
              </div>
              <div class="cases" *ngIf="showCasesModal">

               
                
                <div class="cases-content">

                  <div class="search-container">
                    <input
                    type="text" [(ngModel)]="searchQuery" (ngModelChange)="filterCases()"
                      placeholder="Search"
                      class="search-input"
                    />
      
                    <button type="button" class="cases-close" (click)="showCasesModal = false">
                      X
                    </button>
                  </div>
                  <!-- <div class="button-close">
                    <button type="button" class="cases-close" (click)="showCasesModal = false">
                      X
                    </button>
                  </div> -->
                  <h3>Available Cases</h3>
           
                 

                  <div class="case-table-container">
                  <table>
                    <thead>
                      <tr>
                        <th>Case ID</th>
                        <th>Incident Name</th>
                        <th>Date Committed</th>
                        <th>Place of Incident</th>
                      </tr>
                    </thead>

                    <tbody>

                      <ng-container *ngIf="searchQuery; else allcrimes">
                        <ng-container *ngIf="filteredCases.length > 0; else noResults">
                          <tr 
                          *ngFor="let crime of (searchQuery ? filteredCases : cases)" 
                          (click)="selectCase(crime.crime_id)">

                            <td>
                              <a>
                                <span
                                  [class.highlight]="isFieldMatched(crime.crime_id, searchQuery)"
                                  [innerHTML]="highlight(crime.crime_id)"
                                ></span>
                              </a>
                            </td>
                     

                              <td>
                                <a>
                                  <span
                                    [class.highlight]="isFieldMatched(crime.incident_type, searchQuery)"
                                    [innerHTML]="highlight(crime.incident_type)"
                                  ></span>
                                </a>
                              </td>


                             
                                <td>
                                  <a>
                                    <span
                                      [class.highlight]="isFieldMatched(crime.date_committed, searchQuery)"
                                      [innerHTML]="highlight(crime.date_committed)"
                                    ></span>
                                  </a>
                                </td>

                                
                                  <td>
                                    <a>
                                      <span
                                        [class.highlight]="isFieldMatched(crime.block, searchQuery)"
                                        [innerHTML]="highlight(crime.block)"
                                        [class.highlight]="isFieldMatched(crime.street, searchQuery)"
                                        [innerHTML]="highlight(crime.street)"
                                        [class.highlight]="isFieldMatched(crime.barangay, searchQuery)"
                                        [innerHTML]="highlight(crime.barangay)"
                                      ></span>
                                    </a>
                                  </td>
                          </tr>
                        
                        </ng-container>

                        <ng-template #noResults>
                          <tr>
                            <td colspan="4" class="no-results">
                              No results found for "{{ searchQuery }}"
                            </td>
                          </tr>
                        </ng-template>
                      </ng-container>

                   

                      <ng-template #allcrimes>
                        <tr *ngFor="let case of cases" (click)="selectCase(case.crime_id)">
                          <td>{{ case.crime_id }}</td>
                          <td>{{ case.incident_type }}</td>
                          <td>{{ case.date_committed }}</td>
                          <td>{{ case.block }} {{ case.street }} {{ case.barangay }}</td>
                        </tr>
                      </ng-template>
                      
                    </tbody>
                  </table>
                </div>
                  
                </div>
              </div>
              

              <!-- <div class="action-buttons">
                <button type="button" class="endorse-btn" (click)="onEndorse()">Endorse</button>
                <button type="button" class="dismiss-btn" (click)="onDismiss()">Dismiss</button>
              </div>
               -->
              <div class="table-container">
                <table>
                  <!-- <thead>
              <tr>
                <th>Report ID</th>
                <th>Incident Name</th>
                <th>Incident Date</th>
                <th>Reported Date</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <tr >
                
                <td>{{ selectedReport.report_id }}</td>
               
                <td>{{ selectedReport.subcategory_name }}</td>
              
                <td>{{ selectedReport.incident_date | date }}</td>
              
                <td>{{ selectedReport.reported_date | date }}</td>
              
              </tr>
            </tbody> -->
            <thead>
              <tr>
                <th colspan="2" class="category-label">REPORT DATA</th>
              </tr>
            </thead>
            <tr>
              <td style="padding-bottom: 2rem"><h3>Report ID</h3></td>
              <td style="text-align: end; padding-bottom: 2rem">
                <span>{{ selectedReport.report_id }}</span>
              </td>
            </tr>
            <tr>
            <tr>
              <td style="padding-bottom: 2rem"><h3>Reported Date</h3></td>
              <td style="text-align: end; padding-bottom: 2rem">
                <span>{{ selectedReport.reported_date | date }}</span>
              </td>
            </tr>
            <tr>
              <td style="padding-bottom: 2rem"><h3>Incident Name</h3></td>
              <td style="text-align: end; padding-bottom: 2rem">
                <span>{{ selectedReport.subcategory_name }}</span>
              </td>
            </tr>
            <tr>
              <td style="padding-bottom: 2rem"><h3>Category Name</h3></td>
              <td style="text-align: end; padding-bottom: 2rem">
                <span>{{ selectedReport.category_name }}</span>
              </td>
            </tr>
            <tr>
              <td style="padding-bottom: 2rem"><h3>Incident Date</h3></td>
              <td style="text-align: end; padding-bottom: 2rem">
                <span>{{ selectedReport.incident_date | date }}</span>
              </td>
            </tr>
            <tr>
              <td style="padding-bottom: 2rem; vertical-align: top;"><h3>Narrative</h3></td>
              <td style="text-align: end; padding-bottom: 2rem">
                <div class="narrative">
                  <textarea
                  style="width: 99%; height:150px; text-align: justify; justify-content: flex-start; resize: none;"
                    [(ngModel)]="selectedReport.report_body"
                    placeholder="Description"
                    readonly
                  ></textarea>
                </div>
                
              </td>
            </tr>
       
                
           
                 
                  <tr>
                    <td style="padding-bottom: 2rem"><h3>Submited ID</h3></td>
                    <td style="text-align: end; padding-bottom: 2rem">
                      <a
                        style="color: blue; text-decoration: underline"
                        (click)="viewID(citizenData.citizen_proof)"
                        >View Complainant ID</a
                      >
                    </td>
                  </tr>
                </table>
                 

                    
                 
                      <div  class="tab-buttons" >
                        <button  (click)="setActiveTab('suspect')" [class.active]="activeTab === 'suspect'"><h3>Suspect Data</h3></button>
                          <button (click)="setActiveTab('victim')" [class.active]="activeTab === 'victim'"><h3>Victim Data</h3></button>
                           <button (click)="setActiveTab('evidence')" [class.active]="activeTab === 'evidence'"><h3>Evidence Data</h3> </button>
                         </div>
                     


                         <div class="data-container">
                          <!-- Centered Div -->
                          <div class="data" *ngIf="activeTab === 'suspect'" [@expandCollapse]>
                            <tr>
                              <td><b>Suspect Id</b></td>
                              <td><b>Suspect Name</b></td>
                              <td><b>Civil Status</b></td>
                              <td><b>Gender</b></td>
                              <td><b>Arrested</b></td>
                              <td><b>Deceased</b></td>
                              <td><b>Nationality</b></td>
              
                            </tr>
                        
                            <tr *ngFor="let suspect of suspects" style="padding-right: 2rem" (click)="viewSuspectDesc(suspect.suspect_id)">
                              <td style="text-align: end; padding-bottom: 2rem; padding-right: 6rem;">
                                <span>{{ suspect?.suspect_id }}</span>
                              </td>
                              <td style="text-align: end; padding-bottom: 2rem; padding-right: 6rem;">
                                <span>{{ suspect.first_name }} {{ suspect.last_name }}</span>
                              </td>
                              <td style="text-align: end; padding-bottom: 2rem; padding-right: 6rem;">
                                <span>{{ getCivilStatus(suspect.person_id) || 'Unknown' }}</span>
                              </td>
                              <td style="text-align: end; padding-bottom: 2rem; padding-right: 6rem;">
                                <span>{{ getGenderName(suspect.sex) }}</span>
                              </td>
                              <td style="text-align: end; padding-bottom: 2rem; padding-right: 6rem;">
                                <span>{{ isCaught }}</span>
                              </td>
                              <td style="text-align: end; padding-bottom: 2rem; padding-right: 6rem;">
                                <span>{{ isCitizenDeceased(suspect.bio_status) }}</span>
                              </td>
                              <td style="text-align: end; padding-bottom: 2rem; padding-right: 6rem;">
                                <span>{{ suspectDesc?.ethnicity || 'Unknown' }}</span>
                              </td>
                            </tr>
                          </div>
                        </div>

                  <!-- <div class="susDescModal" *ngIf="viewsusDesc">
                    <div class="susDescModalContent">
                      <button class="modal-close" (click)="closeModal()">
                        X
                      </button>
                      <tr *ngFor="let desc of suspectDesc">
                        <td style="padding-bottom: 2rem"><h3>Suspect Description: {{desc.suspect_id}}</h3></td>

                        <td style="padding-bottom: 2rem"><h3>Suspect Description</h3></td>
                        <td style="text-align: end; padding-bottom: 2rem">
                          <span>{{ desc.suspect_desc }}</span>
                        </td>
                      </tr>
                    </div>
                    
                  </div> -->

                  <div class="susDescModal" *ngIf="viewsusDesc">
                    <div class="susDescModalContent">
                      <button class="modal-close" (click)="closeModal()">X</button>
                  
                      <!-- <div *ngIf="isLoading" class="loading">
                        Loading...
                      </div>   -->
                      <div class="sus-name">
                      <h3>{{ currentSuspectName}}</h3>
                      <p>Suspect</p>
                    </div>

                      <div class="susDescDetails" *ngIf="suspectDesc">
                        
                        <tr>
                          <td><strong>Ethnicity:</strong></td> 
                          <td>{{ suspectDesc.ethnicity }}</td>
                          </tr>
                          <tr>
                            <td><strong>Height:</strong> </td>
                              <td>{{ suspectDesc.height }}</td>
                          </tr>
                          <tr>
                            <td><strong>Weight:</strong> </td>
                            <td>{{ suspectDesc.weight }}</td>
                          </tr>
                          <tr>
                            <td><strong>Hair Color:</strong> </td>
                            <td>{{ suspectDesc.hair_color }}</td>
                          </tr>
                          <tr>
                            <td><strong>Eye Color:</strong> </td>
                              <td>{{ suspectDesc.eye_color }}</td>
                          </tr>
                          <tr>
                            <td><strong>Under Influence of Drug?:</strong></td> 
                            <td>{{ suspectDesc.drug ? 'Yes' : 'No' }}</td>
                          </tr>
                            <tr>
                              <td><strong>Under Influence of Alcohol?:</strong> </td>
                                <td>{{ suspectDesc.alcohol ? 'Yes' : 'No' }}</td>
                            </tr>     
                          <tr>
                            <td><strong>Distinguishing Mark:</strong> </td>
                              <td>{{ suspectDesc.distinguishing_mark }}</td>
                          </tr>                     
                      </div>
                    </div>
                  </div>
                  
                  



                    <div class="data-container">
                      <!-- Centered Div -->
                      <div class="data" *ngIf="activeTab === 'victim'" [@expandCollapse]>
                        <tr>
                          <td><b>Victim Id</b></td>
                          <td><b>Victim Name</b></td>
                          <td><b>Civil Status</b></td>
                          <td><b>Gender</b></td>
                          <td><b>Deceased</b></td>
                          <td><b>Nationality</b></td>
          
                        </tr>
                    
                        <tr *ngFor="let victim of victims" style="padding-right: 2rem">
                          <td style="text-align: end; padding-bottom: 2rem; padding-right: 6rem;">
                            <span>{{ victim?.victim_id }}</span>
                          </td>
                          <td style="text-align: end; padding-bottom: 2rem; padding-right: 6rem;">
                            <span>{{ victim.firstname }} {{ victim.lastname }}</span>
                          </td>
                          <td style="text-align: end; padding-bottom: 2rem; padding-right: 6rem;">
                            <span>{{ getCivilStatus(victim.person_id) || 'Unknown' }}</span>
                          </td>
                          <td style="text-align: end; padding-bottom: 2rem; padding-right: 6rem;">
                            <span>{{ getGenderName(victim.sex) }}</span>
                          </td>

                          <td style="text-align: end; padding-bottom: 2rem; padding-right: 6rem;">
                            <span>{{ isCitizenDeceased(victim.bio_status) }}</span>
                          </td>
                          <td style="text-align: end; padding-bottom: 2rem; padding-right: 6rem;">
                            <span>{{ victimDesc?.ethnicity || 'Unknown' }}</span>
                          </td>
                        </tr>
                      </div>
                    </div>

                   
                  
                    <div *ngIf="activeTab === 'evidence'" [@expandCollapse] >
                     
                      <tr>
                        <td style="padding-bottom: 2rem"><h3>Evidences:</h3></td>
                      </tr>
    
                      <div *ngIf="isLoading">Loading evidences...</div>
                      
                      <div
                        *ngIf="!isLoading && evidences.length > 0"
                        class="evidence-container"
                      >
                        <div
                          *ngFor="let evidence of evidences"
                          class="evidence-item"
                          (click)="openModal(evidence)"
                        >
    
                          <div *ngIf="evidence.content_type.startsWith('image/')">
                            <img
                              [src]="
                                'data:' +
                                evidence.content_type +
                                ';base64,' +
                                cleanBase64(evidence.file_contents)
                              "
                              alt="Evidence Image"
                            />
                          </div>
    
                          <div *ngIf="evidence.content_type === 'application/pdf'">
                            <embed
                              [src]="
                                'data:' +
                                evidence.content_type +
                                ';base64,' +
                                evidence.file_contents
                              "
                              width="100%"
                              height="600px"
                              type="application/pdf"
                            />
                          </div>
                          <div *ngIf="evidence.content_type === 'text/plain'">
                            <pre>{{ decodeBase64(evidence.file_contents) }}</pre>
                          </div>
                          <div
                            *ngIf="
                              evidence.content_type === 'application/msword' ||
                              evidence.content_type ===
                                'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
                            "
                          >
                            <span
                              >Document (.docx) cannot be viewed directly in
                              browser.</span
                            >
                            <!-- You could integrate a viewer for DOCX files, like using Google Docs Viewer or a custom viewer -->
                          </div>
                          <div
                            *ngIf="
                              evidence.content_type ===
                                'application/vnd.ms-excel' ||
                              evidence.content_type ===
                                'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
                            "
                          >
                            <span
                              >Spreadsheet (.xlsx) cannot be viewed directly in
                              browser.</span
                            >
                          </div>
    
                          <!-- Handling Audio files -->
                          <div *ngIf="evidence.content_type.startsWith('audio/')">
                            <audio controls>
                              <source
                                [src]="
                                  'data:' +
                                  evidence.content_type +
                                  ';base64,' +
                                  evidence.file_contents
                                "
                                type="{{ evidence.content_type }}"
                              />
                              Your browser does not support the audio element.
                            </audio>
                          </div>
    
                          <!-- Handling Video files -->
                          <div *ngIf="evidence.content_type.startsWith('video/')">
                            <video width="100%" controls>
                              <source
                                [src]="
                                  'data:' +
                                  evidence.content_type +
                                  ';base64,' +
                                  evidence.file_contents
                                "
                                type="{{ evidence.content_type }}"
                              />
                              Your browser does not support the video element.
                            </video>
                          </div>
    
                          <!-- If file type doesn't match any specific one above -->
                          <div
                            *ngIf="
                              !evidence.content_type.startsWith('image/') &&
                              !evidence.content_type.startsWith('audio/') &&
                              !evidence.content_type.startsWith('video/')
                            "
                          >
                            <strong>File:</strong>
                            <span>{{ evidence.content_type }}</span>
                            <a
                              [href]="
                                'data:' +
                                evidence.content_type +
                                ';base64,' +
                                evidence.file_contents
                              "
                              download
                            >
                              Download File
                            </a>
                          </div>
                        </div>
                      </div>
                      <div *ngIf="!isLoading && evidences.length === 0">
                        No evidences found.
                      </div>
    
                      <div
                        *ngIf="isModalOpen"
                        class="modal-overlay"
                        (click)="closeModal()"
                      >
                        <div
                          class="modal-content"
                          (click)="$event.stopPropagation()"
                        >
                          <button class="modal-close" (click)="closeModal()">
                            X
                          </button>
                          <div *ngIf="selectedEvidence">
                            <div
                              *ngIf="
                                selectedEvidence.content_type.startsWith('image/')
                              "
                            >
                              <img
                                [src]="
                                  'data:' +
                                  selectedEvidence.content_type +
                                  ';base64,' +
                                  cleanBase64(selectedEvidence.file_contents)
                                "
                                alt="Evidence Image"
                              />
                            </div>
                            <div
                              *ngIf="
                                selectedEvidence.content_type === 'application/pdf'
                              "
                            >
                              <embed
                                [src]="
                                  'data:' +
                                  selectedEvidence.content_type +
                                  ';base64,' +
                                  selectedEvidence.file_contents
                                "
                                width="100%"
                                height="600px"
                                type="application/pdf"
                              />
                            </div>
                            <div
                              *ngIf="
                                selectedEvidence.content_type.startsWith('audio/')
                              "
                            >
                              <audio controls>
                                <source
                                  [src]="
                                    'data:' +
                                    selectedEvidence.content_type +
                                    ';base64,' +
                                    selectedEvidence.file_contents
                                  "
                                  type="{{ selectedEvidence.content_type }}"
                                />
                              </audio>
                            </div>
                            <div
                              *ngIf="
                                selectedEvidence.content_type.startsWith('video/')
                              "
                            >
                              <video width="100%" controls>
                                <source
                                  [src]="
                                    'data:' +
                                    selectedEvidence.content_type +
                                    ';base64,' +
                                    selectedEvidence.file_contents
                                  "
                                  type="{{ selectedEvidence.content_type }}"
                                />
                              </video>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div *ngIf="errorMessage">{{ errorMessage }}</div>
                  

                  <div *ngIf="isSignatureVisible" class="modal">
                    <div class="modal-content">
                      <span class="close" (click)="closeSignature()"
                        >&times;</span
                      >
                      <img [src]="currentSignature" alt="E-Signature" />
                    </div>
                  </div>

                  <div *ngIf="isIDvisible" class="modal">
                    <div class="modal-content">
                      <span class="close" (click)="closeID()"
                        >&times;</span
                      >
                      <img [src]="currentID" alt="ID" />
                    </div>
                    </div>

                    <table>
                    <tr>
                      <td style="padding-bottom: 0.5rem; padding-top:10rem;"><h3>Signed By</h3></td>
                      <tr>
                        <td style="text-align: left; padding-bottom: 0.5rem">
                          <div *ngIf="selectedReport.e_signature.startsWith('data:image/')">
                            <img
                              [src]="selectedReport.e_signature"
                              alt="E-Signature"
                              style="max-width: 200px; max-height: 100px;"
                            />
                            
                          </div>
                          <div *ngIf="!selectedReport.e_signature.startsWith('data:image/')">
                            <span>No signature available</span>
                          </div>
                        </td>
                        
                      </tr>
                      <div *ngIf="citizenData" class="sign-name">
                        <span>{{ citizenData.firstname }}, {{ citizenData.lastname }}</span>
                        <span style=" font-weight:bold">Complainant</span>
                      </div>
                      
                      <!-- <tr>
                        <span>{{ citizenData.firstname }}, {{ citizenData.lastname }}</span>
                      </tr> -->
                      
                </table>
              </div>

              

          
            </section>
          </main>
        </div>
      <!-- </form> -->
    </main>
  </div>
</div>
